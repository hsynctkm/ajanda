<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Basit Ajanda UygulamasÄ±</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Roboto Condensed', sans-serif;  
    margin: 20px;
    background: #f8f8f8;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
  }

  .column {
    width: 30%;
    min-height: 80vh;
    background: #ffffff;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    box-sizing: border-box;
    position: relative;
  }

  .column h2 {
    text-align: center;
    margin-bottom: 30px;
    position: relative;
  }

  /* Toplu sil butonlarÄ± */
  .clear-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    padding: 4px 6px;
  }

  #mainColumn {
    width: 35%;
  }

  .event-form {
    background: #fff;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }
  .event-form input, .event-form button, .event-form select {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    font-family: 'Roboto Condensed', sans-serif;
  }

  .event-list {
    margin-top: 20px;
  }

  .event-item {
    background: #fff;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    margin-bottom: 10px;
    position: relative;
  }

  .event-actions button {
    margin: 2px;
    padding: 4px 8px;
    font-size: 14px;
    cursor: pointer;
    font-family: 'Roboto Condensed', sans-serif;
  }

  /* Renk stilleri */
  .event-item.red {
    border-left: 6px solid #e53935;
  }
  .event-item.yellow {
    border-left: 6px solid #fbc02d;
  }
  .event-item.green {
    border-left: 6px solid #388e3c;
  }

  /* Tarih/saat kÃ¼Ã§Ã¼k punto */
  .event-datetime {
    font-size: 0.85em;
    color: #555;
  }

</style>
</head>
<body>
  <div class="column" id="delayedColumn">
    <h2>Ertelenenler
      <button id="clearDelayedBtn" class="clear-btn" title="TÃ¼mÃ¼nÃ¼ Sil">ðŸ—‘</button>
    </h2>
    <div id="delayedEventsContainer"></div>
  </div>

  <div class="column" id="mainColumn">
    <h1 style="text-align:center;">Ajanda</h1>
    <div class="event-form">
      <h2>Etkinlik Ekle</h2>
      <input type="text" id="eventTitle" placeholder="Etkinlik BaÅŸlÄ±ÄŸÄ±" required />
      <input type="datetime-local" id="eventDateTime" required />
      <select id="eventColor">
        <option value="red">KÄ±rmÄ±zÄ± (Ã–ncelikli)</option>
        <option value="yellow">SarÄ± (Orta)</option>
        <option value="green">YeÅŸil (DÃ¼ÅŸÃ¼k)</option>
      </select>
      <button id="addEventBtn">Ekle</button>
    </div>

    <div class="event-list">
      <h2>Etkinliklerim</h2>
      <div id="eventsContainer"></div>
    </div>
  </div>

  <div class="column" id="completedColumn">
    <h2>Tamamlananlar
      <button id="clearCompletedBtn" class="clear-btn" title="TÃ¼mÃ¼nÃ¼ Sil">ðŸ—‘</button>
    </h2>
    <div id="completedEventsContainer"></div>
  </div>

<script>
  // TarayÄ±cÄ± bildirim izni iste
  if ("Notification" in window) {
    Notification.requestPermission();
  }

  const addEventBtn = document.getElementById('addEventBtn');
  const eventTitleInput = document.getElementById('eventTitle');
  const eventDateTimeInput = document.getElementById('eventDateTime');
  const eventColorSelect = document.getElementById('eventColor');

  const eventsContainer = document.getElementById('eventsContainer');
  const completedEventsContainer = document.getElementById('completedEventsContainer');
  const delayedEventsContainer = document.getElementById('delayedEventsContainer');

  const clearCompletedBtn = document.getElementById('clearCompletedBtn');
  const clearDelayedBtn = document.getElementById('clearDelayedBtn');

  let events = JSON.parse(localStorage.getItem('events')) || [];
  let completedEvents = JSON.parse(localStorage.getItem('completedEvents')) || [];
  let delayedEvents = JSON.parse(localStorage.getItem('delayedEvents')) || [];

  function getColorPriority(color) {
    // KÄ±rmÄ±zÄ±:1, SarÄ±:2, YeÅŸil:3 olarak Ã¶ncelik verelim.
    if(color === 'red') return 1;
    if(color === 'yellow') return 2;
    return 3; // green
  }

  // Dizileri renklere gÃ¶re sÄ±rala
  function sortByColor(arr) {
    return arr.sort((a,b) => {
      return getColorPriority(a.color) - getColorPriority(b.color);
    });
  }

  function renderLists() {
    // Her liste yazdÄ±rÄ±lmadan Ã¶nce sÄ±rala
    sortByColor(events);
    sortByColor(completedEvents);
    sortByColor(delayedEvents);

    renderEvents();
    renderCompletedEvents();
    renderDelayedEvents();
  }

  function renderEvents() {
    eventsContainer.innerHTML = '';
    events.forEach((ev, index) => {
      const div = document.createElement('div');
      div.className = 'event-item ' + ev.color;
      const eventDate = new Date(ev.datetime);
      div.innerHTML = `
        <strong>${index+1}. ${ev.title}</strong><br/>
        <span class="event-datetime">Tarih/Saat: ${eventDate.toLocaleString()}</span><br/>
        <a href="mailto:?subject=${encodeURIComponent('HatÄ±rlatma: '+ev.title)}&body=${encodeURIComponent('Etkinlik Tarihi: '+ eventDate.toLocaleString())}">E-posta ile GÃ¶nder</a><br>
        <div class="event-actions">
          <button data-index="${index}" class="complete-btn">TamamlandÄ±</button>
          <button data-index="${index}" class="delay-btn">Ertele</button>
          <button data-index="${index}" class="delete-btn">Sil</button>
        </div>
      `;
      eventsContainer.appendChild(div);
    });

    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        events.splice(idx,1);
        saveAll();
        renderLists();
      });
    });

    document.querySelectorAll('.complete-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        const ev = events[idx];
        completedEvents.push(ev);
        events.splice(idx,1);
        saveAll();
        renderLists();
      });
    });

    document.querySelectorAll('.delay-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        const ev = events[idx];
        delayedEvents.push(ev);
        events.splice(idx,1);
        saveAll();
        renderLists();
      });
    });
  }

  function renderCompletedEvents() {
    completedEventsContainer.innerHTML = '';
    completedEvents.forEach((ev, index) => {
      const div = document.createElement('div');
      div.className = 'event-item ' + ev.color;
      const eventDate = new Date(ev.datetime);
      div.innerHTML = `
        <strong>${index+1}. ${ev.title}</strong><br/>
        <span class="event-datetime">Tamamlanma Tarihi: ${eventDate.toLocaleString()}</span><br/>
        <div class="event-actions">
          <button data-index="${index}" class="undo-btn">Geri Al</button>
          <button data-index="${index}" class="remove-btn">Sil</button>
        </div>
      `;
      completedEventsContainer.appendChild(div);
    });

    document.querySelectorAll('#completedEventsContainer .undo-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        const ev = completedEvents[idx];
        events.push(ev);
        completedEvents.splice(idx,1);
        saveAll();
        renderLists();
      });
    });

    document.querySelectorAll('#completedEventsContainer .remove-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        completedEvents.splice(idx,1);
        saveAll();
        renderLists();
      });
    });
  }

  function renderDelayedEvents() {
    delayedEventsContainer.innerHTML = '';
    delayedEvents.forEach((ev, index) => {
      const div = document.createElement('div');
      div.className = 'event-item ' + ev.color;
      const eventDate = new Date(ev.datetime);
      div.innerHTML = `
        <strong>${index+1}. ${ev.title}</strong><br/>
        <span class="event-datetime">Ertelenen Etkinlik Tarihi: ${eventDate.toLocaleString()}</span><br/>
        <div class="event-actions">
          <button data-index="${index}" class="undo-btn">Geri Al</button>
          <button data-index="${index}" class="remove-btn">Sil</button>
        </div>
      `;
      delayedEventsContainer.appendChild(div);
    });

    document.querySelectorAll('#delayedEventsContainer .undo-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        const ev = delayedEvents[idx];
        events.push(ev);
        delayedEvents.splice(idx,1);
        saveAll();
        renderLists();
      });
    });

    document.querySelectorAll('#delayedEventsContainer .remove-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        delayedEvents.splice(idx,1);
        saveAll();
        renderLists();
      });
    });
  }

  function saveAll() {
    localStorage.setItem('events', JSON.stringify(events));
    localStorage.setItem('completedEvents', JSON.stringify(completedEvents));
    localStorage.setItem('delayedEvents', JSON.stringify(delayedEvents));
  }

  addEventBtn.addEventListener('click', () => {
    const title = eventTitleInput.value.trim();
    const datetime = eventDateTimeInput.value;
    const color = eventColorSelect.value;
    if(!title || !datetime) return;
    events.push({title, datetime, color});
    saveAll();
    eventTitleInput.value = '';
    eventDateTimeInput.value = '';
    eventColorSelect.value = 'red';
    renderLists();
  });

  // Toplu silme butonlarÄ±
  clearCompletedBtn.addEventListener('click', () => {
    if(confirm("TÃ¼m tamamlanan etkinlikleri silmek istediÄŸinize emin misiniz?")) {
      completedEvents = [];
      saveAll();
      renderLists();
    }
  });

  clearDelayedBtn.addEventListener('click', () => {
    if(confirm("TÃ¼m ertelenen etkinlikleri silmek istediÄŸinize emin misiniz?")) {
      delayedEvents = [];
      saveAll();
      renderLists();
    }
  });

  renderLists();

  // Her 60 saniyede bir etkinlikleri kontrol et
  setInterval(() => {
    const now = new Date();
    events.forEach(ev => {
      const eventTime = new Date(ev.datetime);
      // Etkinlik zamanÄ± yaklaÅŸmÄ±ÅŸsa (1 dakika Ã¶nce)
      if(eventTime - now <= 60000 && eventTime - now > 0) {
        // Bildirim gÃ¶ster
        if (Notification.permission === "granted") {
          new Notification("HatÄ±rlatma", {body: ev.title + " etkinliÄŸi birazdan baÅŸlayacak."});
        } else {
          alert(ev.title + " etkinliÄŸi birazdan baÅŸlayacak!");
        }
      }
    });
  }, 60000);
</script>
</body>
</html>
